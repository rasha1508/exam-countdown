<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exam Countdown</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: #fdf6f0; /* Cream/Ivory background */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        font-family: "Inter", sans-serif;
        color: #212121; /* Darker, more black text */
      }
      .widget-container {
        width: 100%;
        max-width: 500px;
        background: #fdf6f0; /* Cream/Ivory main background */
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        border: 1px solid rgba(33, 33, 33, 0.1);
      }
      .widget-header {
        background: #4a4a4a; /* Darker gradient */
        color: white;
        padding: 16px 16px;
        text-align: center;
        position: relative;
      }
      .widget-header::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(
          90deg,
          #a3b18a 0%,
          #f0e6d2 50%,
          #a3b18a 100%
        );
      }
      .widget-header h1 {
        font-family: "Playfair Display", serif;
        font-size: 1.3rem;
        font-weight: 600;
        letter-spacing: 0.3px;
      }
      .widget-content {
        padding: 16px 16px;
      }
      .no-exams {
        text-align: center;
        padding: 30px 16px;
        color: #212121;
        opacity: 0.7;
      }
      .no-exams i {
        font-size: 2.5rem;
        color: #a3b18a;
        margin-bottom: 12px;
      }
      .no-exams p {
        font-size: 0.85rem;
        line-height: 1.4;
      }
      .exam-countdown-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .exam-countdown-item {
        background: white;
        border-radius: 12px;
        padding: 12px 14px;
        border: 1px solid rgba(33, 33, 33, 0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .exam-countdown-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 3px;
        height: 100%;
        background: #a3b18a;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .exam-countdown-item:hover::before {
        opacity: 1;
      }
      .exam-countdown-item:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: rgba(163, 177, 138, 0.3);
      }
      .exam-countdown-item.urgent::before {
        background: #a3b18a;
        opacity: 1;
      }
      .exam-countdown-item.very-urgent::before {
        background: #212121;
        opacity: 1;
      }
      .exam-countdown-item.overdue::before {
        background: #e8c9c0;
        opacity: 1;
      }
      .exam-countdown-item.very-urgent {
        background: linear-gradient(135deg, #fdf6f0 0%, #f0e6d2 100%);
      }
      .exam-countdown-item.overdue {
        background: linear-gradient(135deg, #fdf6f0 0%, #fce8e6 100%);
      }
      .exam-name {
        font-weight: 600;
        color: #212121;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 6px;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .exam-name i {
        color: #a3b18a;
        font-size: 0.85rem;
        flex-shrink: 0;
      }
      .countdown-container {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-shrink: 0;
      }
      .countdown-display {
        display: flex;
        gap: 6px;
      }
      .countdown-unit {
        background: #f0e6d2;
        border-radius: 8px;
        padding: 6px 8px;
        text-align: center;
        min-width: 50px;
        transition: all 0.3s ease;
      }
      .countdown-unit.urgent {
        background: #a3b18a;
        color: white;
      }
      .countdown-unit.very-urgent {
        background: #212121;
        color: white;
      }
      .countdown-unit.overdue {
        background: #e8c9c0;
        color: #212121;
      }
      .countdown-number {
        font-size: 1rem;
        font-weight: 700;
        line-height: 1;
      }
      .countdown-label {
        font-size: 0.65rem;
        opacity: 0.8;
        margin-top: 1px;
      }
      .countdown-status {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 4px 10px;
        border-radius: 16px;
        background: #f0e6d2;
        color: #212121;
        white-space: nowrap;
      }
      .countdown-status.urgent {
        background: #a3b18a;
        color: white;
      }
      .countdown-status.very-urgent {
        background: #212121;
        color: white;
      }
      .countdown-status.overdue {
        background: #e8c9c0;
        color: #212121;
      }
    </style>
  </head>
  <body>
    <div class="widget-container">
      <div class="widget-header">
        <h1>Exam Countdown</h1>
      </div>
      <div class="widget-content">
        <div id="examCountdownList">
          <div class="no-exams">
            <i class="fas fa-graduation-cap"></i>
            <p>
              No upcoming exams found.<br />Add exams in the Assignment & Exam
              Tracker to see countdowns here.
            </p>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Function to load assignments from localStorage
        function loadAssignments() {
          return JSON.parse(localStorage.getItem("assignments")) || [];
        }
        // Function to calculate countdown
        function calculateCountdown(dueDate) {
          const now = new Date();
          const due = new Date(dueDate);
          const diff = due - now;
          if (diff <= 0) {
            return {
              days: 0,
              hours: 0,
              minutes: 0,
              seconds: 0,
              isOverdue: true,
              percentage: 0,
            };
          }
          const days = Math.floor(diff / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
          );
          const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((diff % (1000 * 60)) / 1000);
          // Calculate percentage for progress ring
          const totalDays = Math.ceil(diff / (1000 * 60 * 60 * 24));
          const startDays = Math.ceil(
            (due - new Date(due.getFullYear(), due.getMonth(), due.getDate())) /
              (1000 * 60 * 60 * 24)
          );
          const percentage = Math.max(
            0,
            Math.min(100, ((startDays - days) / startDays) * 100)
          );
          return {
            days,
            hours,
            minutes,
            seconds,
            isOverdue: false,
            percentage,
          };
        }
        // Function to get status based on countdown
        function getStatus(countdown) {
          if (countdown.isOverdue) return "overdue";
          if (countdown.days === 0 && countdown.hours < 6) return "very-urgent";
          if (countdown.days === 0) return "urgent";
          if (countdown.days <= 3) return "upcoming";
          return "upcoming";
        }
        // Function to format countdown display
        function formatCountdown(countdown) {
          if (countdown.isOverdue) {
            return "Overdue";
          }
          const parts = [];
          if (countdown.days > 0) parts.push(`${countdown.days}d`);
          if (countdown.hours > 0) parts.push(`${countdown.hours}h`);
          if (countdown.days === 0 && countdown.minutes > 0)
            parts.push(`${countdown.minutes}m`);
          return parts.join(" ") || "Now";
        }
        // Function to update the exam countdown widget
        function updateExamCountdown() {
          const assignments = loadAssignments();
          const exams = assignments.filter((a) => a.type === "exam");
          const countdownList = document.getElementById("examCountdownList");

          if (exams.length === 0) {
            countdownList.innerHTML = `
                        <div class="no-exams">
                            <i class="fas fa-graduation-cap"></i>
                            <p>No upcoming exams found.<br>Add exams in the Assignment & Exam Tracker to see countdowns here.</p>
                        </div>
                    `;
            return;
          }
          // Sort exams by due date
          const sortedExams = exams.sort(
            (a, b) => new Date(a.dueDate) - new Date(b.dueDate)
          );
          countdownList.innerHTML = "";
          sortedExams.forEach((exam) => {
            const countdown = calculateCountdown(exam.dueDate);
            const status = getStatus(countdown);
            const examItem = document.createElement("div");
            examItem.className = `exam-countdown-item ${status}`;
            examItem.innerHTML = `
                        <div class="exam-name">
                            <i class="fas fa-graduation-cap"></i>
                            <span>${exam.name}</span>
                        </div>
                        <div class="countdown-container">
                            <div class="countdown-display">
                                <div class="countdown-unit ${status}">
                                    <div class="countdown-number">${
                                      countdown.days
                                    }</div>
                                    <div class="countdown-label">Days</div>
                                </div>
                                <div class="countdown-unit ${status}">
                                    <div class="countdown-number">${
                                      countdown.hours
                                    }</div>
                                    <div class="countdown-label">Hours</div>
                                </div>
                                <div class="countdown-unit ${status}">
                                    <div class="countdown-number">${
                                      countdown.minutes
                                    }</div>
                                    <div class="countdown-label">Mins</div>
                                </div>
                            </div>
                            <div class="countdown-status ${status}">
                                ${countdown.isOverdue ? "Overdue" : "Remaining"}
                            </div>
                        </div>
                    `;
            countdownList.appendChild(examItem);
          });
        }
        // Update countdown every second
        function startCountdownTimer() {
          updateExamCountdown();
          setInterval(updateExamCountdown, 1000);
        }
        // Listen for storage changes
        window.addEventListener("storage", function (e) {
          if (e.key === "assignments") {
            updateExamCountdown();
          }
        });
        // Start the countdown timer
        startCountdownTimer();
      });
    </script>
  </body>
</html>

